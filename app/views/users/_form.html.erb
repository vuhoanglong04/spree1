<%= form_with(model: @user) do |form| %>

  <div class="mb-8">
    <div class="flex items-center space-x-2 text-sm text-gray-500 mb-4">
      <%= link_to "Users", users_path, class: "hover:text-gray-700" %>
      <i class="fas fa-chevron-right text-xs"></i>
      <span class="text-gray-900"><%= @user.persisted? ? "Update" : "Create" %> User</span>
    </div>
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-3xl font-bold text-gray-900 mb-2"><%= @user.persisted? ? "Update" : "Create" %> User</h1>
        <p class="text-gray-600"><%= @user.persisted? ? "Update properties of user ##{@user.id}" : "Add a new user to the system" %></p>
      </div>
      <div class="flex items-center space-x-3">
        <%= form.submit "#{@user.persisted? ? "Update" : "Create"} User", class: "bg-primary text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700" %>
      </div>
    </div>
  </div>

  <!-- User Form -->
  <div class="space-y-8">
    <% if @user.errors.any? %>
      <div class="mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded">
        <h2 class="font-semibold mb-2">Please fix the following errors:</h2>
        <ul class="list-disc pl-5">
          <% @user.errors.full_messages.each do |msg| %>
            <li><%= msg %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- Main Content -->
      <div class="lg:col-span-2 space-y-6">
        <!-- Personal Information -->
        <div class="bg-white rounded-xl shadow-sm border p-6">
          <h2 class="text-lg font-semibold text-gray-900 mb-6">Personal Information</h2>
          <div class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <%= form.label :first_name, "First Name *", class: "block text-sm font-medium text-gray-700 mb-2" %>
                <%= form.text_field :first_name, placeholder: "Enter your first name", class: "w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" %>
              </div>

              <div>
                <%= form.label :last_name, "Last Name *", class: "block text-sm font-medium text-gray-700 mb-2" %>
                <%= form.text_field :last_name, placeholder: "Enter your last name", class: "w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" %>
              </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <%= form.label :email, "Email Address*", class: "block text-sm font-medium text-gray-700 mb-2" %>
                <%= form.email_field :email, placeholder: "user@example.com", class: "w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent #{@user.persisted? ? "bg-gray-200" : ""}", readonly: @user.persisted? %>

              </div>

              <div>
                <%= form.label :phone_number, "Phone Number*", class: "block text-sm font-medium text-gray-700 mb-2" %>
                <%= form.text_field :phone_number, placeholder: "+1 (555) 123-4567", class: "w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" %>
              </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <%= form.label :date_of_birth, "Date of Birth", class: "block text-sm font-medium text-gray-700 mb-2" %>
                <%= form.date_field :date_of_birth, class: "w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" %>
              </div>

              <div>
                <%= form.label :gender, "Gender", class: "block text-sm font-medium text-gray-700 mb-2" %>

                <%= form.select :gender,
                                options_for_select([
                                                     ['Select gender', ''],
                                                     ['Male', "male"],
                                                     ['Female', "female"],
                                                   ], @user.gender.to_s),
                                {},
                                class: "w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                %>

              </div>
            </div>

            <div>
              <%= form.label :bio, "Bio", class: "block text-sm font-medium text-gray-700 mb-2" %>

              <%= form.text_area :bio,
                                 rows: 3,
                                 placeholder: "Tell us about this user...",
                                 class: "w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" %>

            </div>
          </div>
        </div>

        <!-- Profile Picture -->
        <div class="bg-white rounded-xl shadow-sm border p-6">
          <h2 class="text-lg font-semibold text-gray-900 mb-6">Profile Picture</h2>
          <div class="space-y-4">
            <div class="flex items-center space-x-6">
              <div class="w-20 h-20 bg-gray-200 rounded-full flex items-center justify-center">
                <% if !@user.image_url.nil? %>
                  <img src="<%= @user.image_url %>" class="rounded-full object-cover" alt=""> </img>
                <% else %>
                  <i class="fas fa-user text-gray-400 text-2xl"></i>
                <% end %>
              </div>

              <div class="flex-1">
                <label class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-gray-400 transition-colors block cursor-pointer">
                  <div class="space-y-2">
                    <i class="fas fa-cloud-upload-alt text-gray-400 text-2xl"></i>
                    <div class="text-sm text-gray-600">
                      <span class="text-primary font-medium">Click to upload</span> or drag and drop
                    </div>
                    <div class="text-xs text-gray-500">
                      PNG, JPG, GIF up to 2MB
                    </div>
                  </div>
                  <%= form.file_field :image_url, class: "hidden", accept: "image/*" %>
                </label>
              </div>
            </div>
          </div>
        </div>


        <!-- Account Settings -->

        <div class="bg-white rounded-xl shadow-sm border p-6">
          <h2 class="text-lg font-semibold text-gray-900 mb-6">Account Settings</h2>
          <div class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <%= form.label :password, "Password *", class: "block text-sm font-medium text-gray-700 mb-2" %>
                <div class="relative">
                  <%= form.password_field :password, placeholder: "Enter password",
                                          class: "w-full px-3 py-2 pr-10 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent",
                                          id: "password" %>
                  <button type="button" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400">
                    <i class="fas fa-eye"></i>
                  </button>
                </div>
                <div class="text-xs text-gray-500 mt-1">Minimum 8 characters</div>
              </div>

              <div>
                <%= form.label :password_confirmation, "Confirm Password *", class: "block text-sm font-medium text-gray-700 mb-2" %>
                <div class="relative">
                  <%= form.password_field :password_confirmation, placeholder: "Confirm password",
                                          class: "w-full px-3 py-2 pr-10 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent",
                                          id: "confirmPassword" %>
                  <button type="button" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400">
                    <i class="fas fa-eye"></i>
                  </button>
                </div>
              </div>
            </div>


          </div>
        </div>
      </div>

      <!-- Sidebar -->
      <div class="lg:col-span-1 space-y-6">
        <!-- Role & Permissions -->
        <div class="bg-white rounded-xl shadow-sm border p-6">
          <h2 class="text-lg font-semibold text-gray-900 mb-6">Role & Permissions</h2>
          <div class="space-y-4">
            <div>
              <%= form.label :role_id, "User Role *", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= form.select :role_id,
                              options_from_collection_for_select(@roles || [], :id, :name, @user.role_id),
                              { prompt: "Select role" },
                              class: "w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
              %>

              <div class="text-xs text-gray-500 mt-1">Determines user permissions and access level</div>
            </div>

          </div>
        </div>

        <!-- Account Status -->
        <div class="bg-white rounded-xl shadow-sm border p-6">
          <h2 class="text-lg font-semibold text-gray-900 mb-6">Account Status</h2>
          <div class="space-y-4">
            <div>
              <label for="status" class="block text-sm font-medium text-gray-700 mb-2">
                Status
              </label>
              <select
                id="status"
                name="status"
                class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
              >
                <option value="pending" <%= @user.persisted? && @user.confirmed_at.nil? ? "selected" : "" %>>Pending
                  Verification
                </option>
                <option value="active" <%= @user.persisted? && @user.deleted_at.nil? ? "selected" : "" %>>Active</option>
                <option value="inactive" <%= @user.persisted? && !@user.deleted_at.nil? ? "selected" : "" %>>Inactive</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Form Actions -->
    <div class="flex items-center justify-between pt-6 border-t">
      <%= link_to users_path, class: "text-gray-600 hover:text-gray-800 font-medium" do %>
        ← Back to Users
      <% end %>
      <div class="flex items-center space-x-3">
        <%= form.submit "#{@user.persisted? ? "Update" : "Create"} User", class: "bg-primary text-white px-6 py-2 rounded-lg font-medium hover:bg-blue-700" %>
      </div>
    </div>
  </div>
<% end %>